{% extends 'base.html' %}
{% load static %}

{% block title %}
  Create Bar
{% endblock %}

{% block styles %}
  {% include 'reservations/create-table.html#create_table_styles' %}
{% endblock %}

{% block scripts %}
  {% include 'reservations/create-table.html#create_table_scripts' %}
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      var stepper = new KTStepper(document.querySelector('#form-stepper'))
    
      stepper.on('kt.stepper.next', function (stepper) {
        stepper.goNext()
      })
    
      stepper.on('kt.stepper.previous', function (stepper) {
        stepper.goPrevious()
      })
    })
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var fileInput = document.querySelector('#bar-form input[type="file"][name="images"]')
      if (!fileInput) return

      var previewContainer = document.createElement('div')
      previewContainer.id = 'image-preview-container'
      previewContainer.className = 'd-flex flex-row flex-wrap gap-4 mt-4'
      fileInput.closest('.bar-form-field')?.appendChild(previewContainer)

      fileInput.addEventListener('change', function (event) {
        var files = event.target.files
        previewContainer.innerHTML = ''

        if (!files || !files.length) return

        Array.from(files).forEach(function (file) {
          if (!file.type.startsWith('image/')) return

          var reader = new FileReader()
          reader.onload = function (e) {
            var img = document.createElement('img')
            img.src = e.target.result
            img.alt = file.name
            img.className = 'img-fluid rounded'
            img.style.maxWidth = '200px'
            img.style.maxHeight = '200px'
            img.style.objectFit = 'cover'

            var wrapper = document.createElement('div')
            wrapper.className = 'bar-image-preview-wrapper'
            wrapper.appendChild(img)

            previewContainer.appendChild(wrapper)
          }

          reader.readAsDataURL(file)
        })
      })
    })
  </script>
{% endblock %}

{% block content %}
  <div class="stepper stepper-pills stepper-column d-flex flex-row justify-content-center gap-12" id="form-stepper">
    <menu class="card p-12 m-0 w-lg-350px h-fit justify-content-center">
      <div class="stepper-nav">
        {% for step in stepper %}
          <div class="stepper-item me-5{% if step.current and step.current.strip %} current{% endif %}" data-kt-stepper-element="nav">
            <div class="stepper-wrapper d-flex align-items-center">
              <div class="stepper-icon w-40px h-40px">
                <i class="stepper-check fas fa-check"></i>
                <span class="stepper-number">{{ step.num }}</span>
              </div>
              <div class="stepper-label">
                <h3 class="stepper-title">{{ step.title }}</h3>
                <div class="stepper-desc">{{ step.desc }}</div>
              </div>
            </div>
            <div class="stepper-line h-40px"></div>
          </div>
        {% endfor %}
      </div>
    </menu>

    <div class="d-flex flex-column gap-8">
      <section class="flex-column w-lg-600px gap-8 current" id="details-form-list" data-kt-stepper-element="content">
        <header class="flex-row justify-content-between align-items-center card p-8">
          <h2 class="m-0">Bar Details</h2>
          <div class="bar-form-block">
              <form method="post" enctype="multipart/form-data" id="bar-form">
                  {% csrf_token %}
                  {% for field in bar_form %}
                    {% if field.name == 'images' %}
                      <br>
                      <div class="bar-form-field">
                        <label class="bar-form-label">{{ field.label }}</label><br>
                        {{ field }}
                        {% if field.errors %}
                        <ul class="error-list">
                          {% for error in field.errors %}
                            <li>{{ error }}</li>
                          {% endfor %}
                        </ul>
                        {% endif %}
                      </div>
                    {% else %}
                      <div class="bar-form-field">
                        <label class="bar-form-label">{{ field.label }}</label>
                        {{ field }}
                        {% if field.errors %}
                        <ul class="error-list">
                          {% for error in field.errors %}
                            <li>{{ error }}</li>
                          {% endfor %}
                        </ul>
                        {% endif %}
                      </div>
                    {% endif %}
                  {% endfor %}
              </form>
         </div>
        </header>
      </section>

      <section class="flex-column w-lg-600px gap-8" data-kt-stepper-element="content">
        <header class="flex-row justify-content-between align-items-center card p-8">
          <h2 class="m-0">Add Events</h2>
        </header>
      </section>

      <section class="flex-column w-lg-600px gap-8" id="table-form-list" data-kt-stepper-element="content">
        <header class="flex-row justify-content-between align-items-center card p-8">
          <h2 class="m-0">Add Tables</h2>
          <button type="button" class="btn btn-sm btn-info" data-repeater-create><span>Add Listing</span></button>
        </header>
        {% include 'reservations/create-table.html#create_table_form' %}
      </section>

      <section class="flex-column w-lg-600px gap-8" data-kt-stepper-element="content">
        <header class="flex-row justify-content-between align-items-center card p-8">
          <h2 class="m-0">Publish Your Bar</h2>
        </header>
      </section>

      <footer class="flex-row justify-content-between align-items-center card p-8">
        <button type="button" class="btn btn-light-info border border-info" data-kt-stepper-action="previous"><span>Back</span></button>
        <button type="button" class="btn btn-info" data-kt-stepper-action="next">
          <span>Continue</span>
          <i class="ki-solid ki-arrow-right fs-2 p-0"></i>
        </button>
        <button type="submit" class="btn btn-info" form="bar-form" data-kt-stepper-action="submit">
          <span class="indicator-label">Submit</span>
          <span class="indicator-progress">Please wait... <span class="spinner-border spinner-border-sm align-middle ms-2"></span></span>
        </button>
      </footer>
    </div>

    <div class="flex-column"></div>
  </div>
{% endblock %}
